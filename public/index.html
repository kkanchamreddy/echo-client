<html>
	<head>
		<title> Echo Client </title>
	 	<script src="/js/binary.min.js"></script>

	</head>
	<body>
		<button type="submit" id ="askBtn" onclick="handleClick()" > Ask Me </button>
		<script>
			var isAskingMode = false;
			var $askBtn = document.getElementById('askBtn');
			if (!navigator.getUserMedia)
			navigator.getUserMedia = navigator.getUserMedia ||
									navigator.webkitGetUserMedia ||
									navigator.mozGetUserMedia ||
									navigator.msGetUserMedia;
			if (!navigator.getUserMedia) {
				alert('getUserMedia not supported in your browser.');
			}

			// Connect to Binary.js server
			var client = new BinaryClient('ws://localhost:9000');

			function recordAndSendToServer(e) {
				window.Stream = client.createStream();
				var left = e.inputBuffer.getChannelData(0);
				window.Stream.write(left);
			}

			function receiveAndPlayResponse() {
				// Received new audio stream from server!
				client.on('stream', function(stream, meta){
					// Buffer for parts
					var parts = [];
					// Got new data
					stream.on('data', function(data){
						parts.push(data);
					});
					stream.on('end', function(){
						// Play the audio in browser!

					});
				});
			}

			function handleClick() {
				isAskingMode = !isAskingMode;
				//if was not asking,
				if (isAskingMode) {
					recordAndSendToServer();
					//TODO: Toggle the button state To Done Asking
					$askBtn.innerText = 'Done Asking';
					//TODO: Stream the audio from client to Server

				} else {
					//TODO: Receive the audio response from server
					receiveAndPlayResponse();
					//TODO: Disable the button until the response is played
					event.currentTarget.disbled = true;
					event.currentTarget.innerText = 'Ask';
				}
			}

		</script>
	</body>
</html>
